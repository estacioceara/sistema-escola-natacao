#!/usr/bin/env php
<?php

use App\Entity\EducationalPlan;
use App\Entity\MonthlyFee;
use App\Entity\Student;

require dirname(__DIR__) . '/vendor/autoload.php';

$entityManager = require dirname(__DIR__) . '/doctrine.php';

$plans = include 'DataFixtures/plans.php';

foreach ($plans as $data) {
    $plan = new EducationalPlan();
    $plan->setName($data['name']);
    $plan->setValue($data['value']);
    $plan->setStatus($data['status']);
    $plan->setUpdatedAt(new DateTime());
    $plan->setCreatedAt(new DateTime());

    $entityManager->persist($plan);
    echo "Inserindo novo plano para testes..." . PHP_EOL;
}

$students = include 'DataFixtures/student.php';



foreach ($students as $data) {
    $student = new Student(
            $data['name'],
            $data['birth'],
            $data['cpf'],
            $data['phone'],
            $data['notes'],
            new \App\Entity\Address(),
            new \App\Entity\StudentResponsible()
    );

    //$student->setUpdatedAt(new DateTime());
    //$student->setCreatedAt(new DateTime());

    $entityManager->persist($student);
    echo "Inserindo novo aluno para testes..." . PHP_EOL;
}


$entityManager->flush();

$studentsAll = $entityManager->getRepository(Student::class)->findAll();

$monthlyfees = include 'DataFixtures/monthlyfee.php';
foreach ($monthlyfees as $data) {
    $randomStudent = $studentsAll[array_rand($studentsAll)];
    $fee = new MonthlyFee(
            $data['value'],
            $randomStudent,
            $data['dueDate'],
            $data['billingPeriod'],
    );

    $fee->setPaid($data['paid']);
    //$student->setUpdatedAt(new DateTime());
    //$student->setCreatedAt(new DateTime());

    $entityManager->persist($fee);
    echo "Inserindo novo mensalidade para testes..." . PHP_EOL;
}


$entityManager->flush();
